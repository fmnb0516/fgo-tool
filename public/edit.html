<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <title>FGO データ編集</title>
</head>

<body>

  <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
    <div class="container">
      <a href="./index.html" class="navbar-brand">FGO データ編集</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="./list.html">サーヴァント一覧</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./edit.html">サーヴァントデータ作成</a>
          </li>
        </ul>

      </div>
    </div>
  </div>

  <div class="container" style="padding-top: 70px;" id="container">

  </div>

  <script type="text/x-handlebars" id="template-hogu-effect-input">
    <tr>
      <td>
        <select class="form-control hogu-type-input" value="{{type}}">
        </select>
      </td>
      <td>
        <input type="text" class="form-control hogu-tern-input" value="{{tern}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-count-input" value="{{count}}">
      </td>
      <td>
        <select class="form-control hogu-target-input" value="{{target}}">
          <option value="self">自身</option>
          <option value="other-all">自身を除く全体</option>
          <option value="self-other">全体</option>
          <option value="other-single">味方単体</option>
          <option value="enemy-single">敵単体</option>
          <option value="enemy-all">敵全体</option>
        </select>
      </td>
      <td>
        <select class="form-control hogu-beforeafter-input" value="{{beforeafter}}">
            <option value="before">前</option>
            <option value="after">後</option>
        </select>
      </td>
      <td>
        <select class="form-control hogu-beforeafter-input" value="{{lvoc}}">
          <option value="lv">Level</option>
          <option value="oc">OC</option>
        </select>
      </td>
      <td>
        <input type="text" class="form-control hogu-desc-input" value="{{desc}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-val1-input" value="{{v1}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-val2-input" value="{{v2}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-val3-input" value="{{v3}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-val4-input" value="{{v4}}">
      </td>
      <td>
        <input type="text" class="form-control hogu-val5-input" value="{{v5}}">
      </td>
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-skill-effect-input">
    <tr>
      <td>
        <select class="form-control skill-type-input" value="{{type}}">
        </select>
      </td>
      <td>
        <input type="text" class="form-control skill-tern-input" value="{{tern}}">
      </td>
      <td>
        <input type="text" class="form-control skill-count-input" value="{{count}}">
      </td>
      <td>
        <select class="form-control skill-target-input" value="{{target}}">
          <option value="self">自身</option>
          <option value="other-all">自身を除く全体</option>
          <option value="self-other">全体</option>
          <option value="other-single">味方単体</option>
          <option value="enemy-single">敵単体</option>
          <option value="enemy-all">敵全体</option>
        </select>
      </td>
      <td>
        <input type="text" class="form-control skill-desc-input" value="{{desc}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val1-input" value="{{v1}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val2-input" value="{{v2}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val3-input" value="{{v3}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val4-input" value="{{v4}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val5-input" value="{{v5}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val6-input" value="{{v6}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val6-input" value="{{v7}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val8-input" value="{{v8}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val9-input" value="{{v9}}">
      </td>
      <td>
        <input type="text" class="form-control skill-val10-input" value="{{v10}}">
      </td>     
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-classskill-effect-input">
    <tr>
      <td>
        <select class="form-control skill-type-input" value="{{type}}">
        </select>
      </td>
      <td>
        <input type="text" class="form-control magnification-input" value="{{magnification}}" style="width: 50px;">
      </td>
      <td>
        <input type="text" class="form-control desc-input" value="{{desc}}">
      </td>
      <td>
          <button type="button" class="btn btn-danger btn-sm delete-row-btn">削除</button>
      </td>
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-classskill-input">
    <div class="col-lg-12 classskill-entry">
      <div class="card border-primary delete-entry">
        <div class="card-header">
          <button type="button" class="btn btn-danger btn-sm delete-entry-btn"
            style="position: absolute;right: 5px;top: -15px;">削除</button>
          <input type="text" class="form-control classkill-name-input" value={{name}}>
        </div>
        
        <div class="card-body">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>種別</th>
                <th>倍率</th>
                <th>説明文</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              {{#each effect}}
                {{include "template-classskill-effect-input" this}}
              {{/each}}
            </tbody>
          </table>
          <button type="button" class="btn btn-primary btn-sm class-skill-effect-add-btn">追加</button>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars" id="template-tag-input">
    <input class="tag-input" style="width: 30px;margin-left: 5px;margin-bottom: 5px;" type="text" value="{{this}}">
  </script>

  <script type="text/x-handlebars" id="template-status-input">
    <div class="row alert alert-dismissible alert-secondary delete-entry" style="padding: 10px;">
        <div style="position: absolute;right: 5px;top: -15px;">
          <button type="button" class="btn btn-danger btn-sm delete-entry-btn">削除</button>
        </div>

        <div class="col-lg-2">
          <div class="form-group">
            <label>Level</label>
            <input type="text" class="form-control" value="{{level}}">
          </div>
        </div>
        <div class="col-lg-5">
          <div class="form-group">
            <label>HP</label>
            <input type="text" class="form-control" value="{{hp}}">
          </div>
        </div>
        <div class="col-lg-5">
          <div class="form-group">
            <label>ATK</label>
            <input type="text" class="form-control" value="{{atk}}">
          </div>
        </div>
      </div>
  </script>

  <script type="text/x-handlebars" id="template-editable-form">

    <button type="button" class="btn btn-outline-primary" id="save-btn">保存</button>
    <hr/>

    <div class="row">
      <div class="col-lg-6">
        <div class="form-group">
          <label for="name-input">名称</label>
          <input type="text" class="form-control" id="name-input" value="{{data.servant.name}}">
        </div>
      </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="class-input">クラス</label>
          <select class="form-control" id="class-input" value="{{data.servant.clazz}}">
            {{#each constData.servantClass}}
            <option value="{{id}}">{{label}}</option>
            {{/each}}
          </select>
        </div>
      </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="rare-input">レア度</label>
          <input type="text" class="form-control" id="rare-input" value="{{data.servant.rare}}">
        </div>
      </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="cost-input">コスト</label>
          <input type="text" class="form-control" id="cost-input" value="{{data.servant.cost}}">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        コマンドカード
        <div class="row" style="padding: 10px;">
          <div class="col-lg-12"><span class="badge badge-primary">Arts</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-arts-count-input">枚数</label>
              <input type="text" class="form-control" id="command-arts-count-input" value="{{data.card.arts.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-arts-hit-input">ヒット数</label>
              <input type="text" class="form-control" id="command-arts-hit-input" value="{{data.card.arts.hit}}">
            </div>
          </div>

          <div class="col-lg-12"><span class="badge badge-success">Quick</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-quick-count-input">枚数</label>
              <input type="text" class="form-control" id="command-quick-count-input" value="{{data.card.quick.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-quick-hit-input">ヒット数</label>
              <input type="text" class="form-control" id="command-quick-hit-input" value="{{data.card.quick.hit}}">
            </div>
          </div>

          <div class="col-lg-12"><span class="badge badge-danger">Buster</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-buster-count-input">枚数</label>
              <input type="text" class="form-control" id="command-buster-count-input" value="{{data.card.buster.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-buster-hit-input">ヒット数</label>
              <input type="text" class="form-control" id="command-buster-hit-input" value="{{data.card.buster.hit}}">
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-lg-12">
        ステータス &nbsp;&nbsp;
        <button type="button" class="btn btn-primary" id="add-status-btn">追加</button>

        <br /><br />
        <div id="status-container">
        {{#each data.status}}
          {{include "template-status-input" this}}
        {{/each}}
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        隠しステータス
        <div class="row" style="padding: 10px;">
          <div class="col-lg-2">
            <div class="form-group">
              <label for="tenchizin-input">相性</label>
              <select class="form-control" id="tenchizin-input" value="{{data.servant.tenchizin}}">
                {{#each constData.tenchizin}}
                <option value="{{id}}">{{label}}</option>
                {{/each}}
              </select>
            </div>
          </div>


          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-na">N/A</label>
              <input id="input-na" type="text" class="form-control" value="{{data.hidden.na}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-star-occurrence">スター発生率</label>
              <input id="input-star-occurrence" type="text" class="form-control" value="{{data.hidden.staroccurrence}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-star-collection">スター集中度</label>
              <input id="input-star-collection" type="text" class="form-control" value="{{data.hidden.starcollection}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-dr">DR</label>
              <input id="input-dr" type="text" class="form-control" value="{{data.hidden.dr}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-nd">ND</label>
              <input id="input-nd" type="text" class="form-control" value="{{data.hidden.nd}}">
            </div>
          </div>

          <div class="col-lg-12">
            <label for="input-tag">属性</label>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-primary btn-sm" id="add-tag-btn">追加</button>

            <div style="padding: 5px" id="tag-container">
              {{#each data.hidden.tag}}
                {{include "template-tag" this}}
              {{/each}}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        クラススキル &nbsp;&nbsp;
        <button type="button" class="btn btn-primary btn-sm" id="class-skill-add-btn">追加</button>

        <div class="row" id="class-skill-container" style="padding: 10px;">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル1
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-1-name-input">名称</label>
              <input type="text" class="form-control" id="skill-1-name-input" value="{{data.skill1.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input type="text" class="form-control" id="skill-1-ct-input" value="{{data.skill1.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th style="width: 100px;">種別</th>
                  <th style="width: 50px;">ターン</th>
                  <th style="width: 50px;">回数</th>
                  <th style="width: 100px;">対象</th>
                  <th style="width: 400px;">説明文</th>
                  <th style="width: 10px;">Lv1</th>
                  <th style="width: 50px;">Lv2</th>
                  <th style="width: 50px;">Lv3</th>
                  <th style="width: 50px;">Lv4</th>
                  <th style="width: 50px;">Lv5</th>
                  <th style="width: 50px;">Lv6</th>
                  <th style="width: 50px;">Lv7</th>
                  <th style="width: 50px;">Lv8</th>
                  <th style="width: 50px;">Lv9</th>
                  <th style="width: 50px;">Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill1.effect}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
            <button type="button" class="btn btn-primary btn-sm skill-effect-add-btn">追加</button>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル2
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-2-name-input">名称</label>
              <input type="text" class="form-control" id="skill-2-name-input" value="{{data.skill2.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input type="text" class="form-control" id="skill-2-ct-input" value="{{data.skill2.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th style="width: 100px;">種別</th>
                  <th style="width: 50px;">ターン</th>
                  <th style="width: 50px;">回数</th>
                  <th style="width: 100px;">対象</th>
                  <th style="width: 400px;">説明文</th>
                  <th style="width: 10px;">Lv1</th>
                  <th style="width: 50px;">Lv2</th>
                  <th style="width: 50px;">Lv3</th>
                  <th style="width: 50px;">Lv4</th>
                  <th style="width: 50px;">Lv5</th>
                  <th style="width: 50px;">Lv6</th>
                  <th style="width: 50px;">Lv7</th>
                  <th style="width: 50px;">Lv8</th>
                  <th style="width: 50px;">Lv9</th>
                  <th style="width: 50px;">Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill2.effect}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
            <button type="button" class="btn btn-primary btn-sm skill-effect-add-btn">追加</button>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル3
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-2-name-input">名称</label>
              <input type="text" class="form-control" id="skill-3-name-input" value="{{data.skill3.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input type="text" class="form-control" id="skill-3-ct-input" value="{{data.skill3.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th style="width: 100px;">種別</th>
                  <th style="width: 50px;">ターン</th>
                  <th style="width: 50px;">回数</th>
                  <th style="width: 100px;">対象</th>
                  <th style="width: 400px;">説明文</th>
                  <th style="width: 10px;">Lv1</th>
                  <th style="width: 50px;">Lv2</th>
                  <th style="width: 50px;">Lv3</th>
                  <th style="width: 50px;">Lv4</th>
                  <th style="width: 50px;">Lv5</th>
                  <th style="width: 50px;">Lv6</th>
                  <th style="width: 50px;">Lv7</th>
                  <th style="width: 50px;">Lv8</th>
                  <th style="width: 50px;">Lv9</th>
                  <th style="width: 50px;">Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill3.effect}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
            <button type="button" class="btn btn-primary btn-sm skill-effect-add-btn">追加</button>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        宝具
        <div class="row" style="padding: 10px;">
          <div class="col-lg-6">
            <div class="form-group">
              <label for="hogu-name-input">名称</label>
              <input type="text" class="form-control" id="hogu-name-input" value="{{data.hogu.name}}">
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-type-input">種別</label>
              <select class="form-control" id="hogu-type-input" value="{{data.hogu.type}}">
                <option value="all">全体</option>
                <option value="single">単体</option>
                <option value="support">補助</option>
              </select>
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-card-input">カード</label>
              <select class="form-control" id="hogu-card-input" value="{{data.hogu.card}}">
                <option value="a">Arts</option>
                <option value="q">Quick</option>
                <option value="b">Buster</option>
              </select>
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-hit-input">Hit数</label>
              <input type="text" class="form-control" id="hogu-hit-input" value="{{data.hogu.hit}}">
            </div>
          </div>
          <div class="col-lg-12 table-responsive hogu-effect-entry">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>ターン</th>
                  <th>回数</th>
                  <th>対象</th>
                  <th>前・後</th>
                  <th>OC・Lv</th>
                  <th>説明文</th>
                  <th>1</th>
                  <th>2</th>
                  <th>3</th>
                  <th>4</th>
                  <th>5</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.hogu.effect}}
                  {{include "template-hogu-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
            <button type="button" class="btn btn-primary btn-sm hogu-effect-add-btn">追加</button>
          </div>
        </div>

      </div>
    </div>
  </script>

  <div>
    <script src="jquery/jquery-3.4.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="handlebars/handlebars-v4.2.0.js"></script>
    <script src="app/fgo-const-data.js"></script>
    <script src="app/utils.js"></script>

    <script type="text/javascript">

      $(function () {
        var template = Handlebars.compile($("#template-editable-form").html());

        var html = template({
          constData: fgoConstData()
        });
        $("#container").html(html);

        $(document).on("click", "#add-status-btn", function () {
          var tpl = Handlebars.compile($("#template-status-input").html());
          $("#status-container").append(tpl({}));
        });

        $(document).on("click", ".delete-entry-btn", function () {
          $(this).parents(".delete-entry").remove();
        });

        $(document).on("click", ".delete-row-btn", function () {
          $(this).parents("tr").remove();
        });

        $(document).on("click", "#add-tag-btn", function () {
          var tpl = Handlebars.compile($("#template-tag-input").html());
          $("#tag-container").append(tpl(""));
          $(".tag-input").last().focus();
        });

        $(document).on("blur", ".tag-input", function () {
          if ($(this).val().trim() === "") {
            $(this).remove();
          }
        });

        $(document).on("click", "#class-skill-add-btn", function () {
          var tpl = Handlebars.compile($("#template-classskill-input").html());
          $("#class-skill-container").append(tpl({}));
        });

        $(document).on("click", ".class-skill-effect-add-btn", function () {
          var tpl = Handlebars.compile($("#template-classskill-effect-input").html());
          $(this).parents(".classskill-entry").find("tbody").append(tpl({}));
        });

        $(document).on("click", ".skill-effect-add-btn", function () {
          var tpl = Handlebars.compile($("#template-skill-effect-input").html());
          $(this).parents(".skill-effect-entry").find("tbody").append(tpl({}));
        });

        $(document).on("click", ".hogu-effect-add-btn", function () {
          var tpl = Handlebars.compile($("#template-hogu-effect-input").html());
          $(this).parents(".hogu-effect-entry").find("tbody").append(tpl({}));
        });

      });

    </script>
  </div>
</body>

</html>