<!doctype html>
<html lang="ja">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes,maximum-scale=5">
    <meta charset="UTF-8">
    <title>FGO TOOL</title>

    <link rel="icon" href="favicon.ico">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="resources/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="resources/jquery-ui-1.12.1/jquery-ui.min.css">

    <script type="text/javascript">
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(function () {
                    console.log('Service worker registered!');
                });
        }
    </script>
</head>

<body>

    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
        <div class="container">
            <a href="#" class="navbar-brand">FGO TOOL</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#list">サーヴァント一覧</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#calc">FGO 獲得NP計算機</a>
                    </li>
                </ul>

            </div>
        </div>
    </div>

    <div class="container" style="padding-top: 70px;" id="container">
    </div>

    <script type="text/x-handlebars" id="template-npcalc-result">
        <div id="atackerContainer" class="row"
            style="border: 1px solid #f0f0f0;border-radius: 0.25rem;position: relative;">
            <div style="position: absolute;top: -10px;left: 10px;">
                <span class="badge badge-primary" style="cursor: pointer">アタッカー</span>
            </div>

            <div style="position: absolute;top: -10px;right: 10px;">
                <button id="clearnBtn" type="button" class="btn btn-primary btn-sm">クリア</button>
            </div>

            <div class="col-lg-12" style="padding-top: 10px;">
                <div class="form-group">
                    <label for="name-input">名称</label>
                    <input autocomplete="off" type="text" class="form-control" id="target-servant-input" value="">
                    <small class="form-text text-muted">
                        NP計算対象のサーヴァント名を入力してください
                        <br />
                        入力に応じて候補がサジェスト表示されます。
                    </small>
                </div>
            </div>

            <div class="col-lg-12" style="margin-bottom: 10px;">
                <button type="button" class="btn btn-primary btn-sm toggle-btn"
                    data-target="#target-basic">基本データ</button>
                <small class="form-text text-muted">
                    対象サーヴァントのATK,スキルの使用可否等の基本データを表示します。
                </small>
            </div>

            <div class="col-lg-12" id="target-basic" style="display: none">
                <div class="row" style="padding: 15px;">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="level-input">Lv</label>
                                    <select class="form-control" id="level-input">
                                    </select>
                                    <small class="form-text text-muted">
                                        選択したレベルに応じてATKが切り替わります
                                    </small>
                                </div>
                            </div>

                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label for="atk-input">ATK</label>
                                    <input readonly id="atk-input" type="number" class="form-control" value="">
                                    <small class="form-text text-muted">
                                        サーヴァントのATKを入力してください
                                    </small>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label for="for-atk-input">フォウくん(atk)</label>
                                    <input id="for-atk-input" type="number" class="form-control" value="1000">
                                    <small class="form-text text-muted">
                                        フォウくんで追加されるATKを入力してください
                                    </small>
                                </div>
                            </div>

                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="hogu-lv-input">宝具Lv</label>
                                    <select class="form-control" id="hogu-lv-input">
                                        <option value="1">lv1</option>
                                        <option value="2">lv2</option>
                                        <option value="3">lv3</option>
                                        <option value="4">lv4</option>
                                        <option value="5">lv5</option>
                                    </select>
                                    <small class="form-text text-muted">
                                        宝具レベルを選択してください
                                    </small>
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="hogu-oc-input">宝具OC</label>
                                    <select class="form-control" id="hogu-oc-input">
                                        <option value="1">oc1</option>
                                        <option value="2">oc2</option>
                                        <option value="3">oc3</option>
                                        <option value="4">oc4</option>
                                        <option value="5">oc5</option>
                                    </select>
                                    <small class="form-text text-muted">
                                        宝具のOCを選択してください
                                    </small>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label for="target-skill1-lv-input">スキル1Lv</label>
                                    <select class="form-control" id="target-skill1-lv-input">
                                        <option value="">使用しない</option>
                                        <option value="1">lv1</option>
                                        <option value="2">lv2</option>
                                        <option value="3">lv3</option>
                                        <option value="4">lv4</option>
                                        <option value="5">lv5</option>
                                        <option value="6">lv6</option>
                                        <option value="7">lv7</option>
                                        <option value="8">lv8</option>
                                        <option value="9">lv9</option>
                                        <option value="10">lv10</option>
                                    </select>
                                    <small class="form-text text-muted" id="target-skill1-lv-name"></small>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label for="target-skill2-lv-input">スキル2Lv</label>
                                    <select class="form-control" id="target-skill2-lv-input">
                                        <option value="">使用しない</option>
                                        <option value="1">lv1</option>
                                        <option value="2">lv2</option>
                                        <option value="3">lv3</option>
                                        <option value="4">lv4</option>
                                        <option value="5">lv5</option>
                                        <option value="6">lv6</option>
                                        <option value="7">lv7</option>
                                        <option value="8">lv8</option>
                                        <option value="9">lv9</option>
                                        <option value="10">lv10</option>
                                    </select>
                                    <small class="form-text text-muted" id="target-skill2-lv-name"></small>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label for="target-skill3-lv-input">スキル3Lv</label>
                                    <select class="form-control" id="target-skill3-lv-input">
                                        <option value="">使用しない</option>
                                        <option value="1">lv1</option>
                                        <option value="2">lv2</option>
                                        <option value="3">lv3</option>
                                        <option value="4">lv4</option>
                                        <option value="5">lv5</option>
                                        <option value="6">lv6</option>
                                        <option value="7">lv7</option>
                                        <option value="8">lv8</option>
                                        <option value="9">lv9</option>
                                        <option value="10">lv10</option>
                                    </select>
                                    <small class="form-text text-muted" id="target-skill3-lv-name"></small>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <small class="form-text text-muted">
                                    ※「名称」にて表示された候補サーヴァントを選択することでデータが自動で補間されます
                                </small>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="col-lg-12" style="margin-bottom: 10px;">
                <button type="button" class="btn btn-primary btn-sm toggle-btn" data-target="#target-detail">詳細</button>
                <small class="form-text text-muted">
                    対象サーヴァントのその他データを表示します。<br />一部データは編集不可です。
                </small>
            </div>

            <div class="col-lg-12" id="target-detail" style="display: none">
                <div class="row" style="padding: 15px;">
                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="na-input">N/A</label>
                            <input readonly id="na-input" type="number" class="form-control" value="">
                            <small class="form-text text-muted">NP効率</small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="hit-input">ヒット数</label>
                            <input readonly type="number" class="form-control" id="hit-input" value="">
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="card-input">Card</label>
                            <select disabled class="form-control" id="card-input">
                                <option value=""></option>
                                <option value="a">Arts</option>
                                <option value="b">Buster</option>
                                <option value="q">Quick</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="hogu-type-input">宝具種別</label>
                            <select disabled class="form-control" id="hogu-type-input">
                                <option value=""></option>
                                <option value="support">補助宝具</option>
                                <option value="all">全体宝具</option>
                                <option value="single">単体宝具</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-np-buf-input">NP獲得量バフ</label>
                            <input readonly id="target-np-buf-input" type="text" class="form-control" value="">
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-np-get-input">ターン後NP獲得</label>
                            <input readonly id="target-np-get-input" type="text" class="form-control" value="">
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-tenchizin-input">天地人</label>
                            <select disabled class="form-control" id="target-tenchizin-input">
                                <option value="ten">天</option>
                                <option value="chi">地</option>
                                <option value="hito">人</option>
                                <option value="hoshi">星</option>
                                <option value="juu">獣</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="tokkou-enable-input">特攻宝具</label>
                            <select class="form-control" id="tokkou-enable-input">
                                <option value="y">あり</option>
                                <option value="n">なし</option>
                            </select>
                            <small class="form-text text-muted">
                                宝具ダメージに特攻を反映するか選択します
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-compatibility-input">有利不利</label>
                            <select class="form-control" id="target-compatibility-input">
                                <option value="1.0">等倍</option>
                                <option value="2.0">2倍</option>
                                <option value="1.5">1.5倍</option>
                                <option value="0.5">不利</option>
                            </select>
                            <small class="form-text text-muted">
                                敵との相性有利・不利を選択します
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-card-buf-input">攻バフ・防デバフ</label>
                            <input readonly id="target-atk-buf-input" type="text" class="form-control" value="">
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-card-buf-input">Cardバフ</label>
                            <input readonly id="target-card-buf-input" type="text" class="form-control" value="">
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="target-hogu-buf-input">宝具バフ</label>
                            <input readonly id="target-hogu-buf-input" type="text" class="form-control" value="">
                            <small class="form-text text-muted">その他、特攻バフなど</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <br />

        <div class="row" style="border: 1px solid #f0f0f0;border-radius: 0.25rem;position: relative;">
            <div style="position: absolute;top: -10px;left: 10px;">
                <span class="badge badge-primary" style="cursor: pointer">サポート</span>
            </div>

            <div class="col-lg-12" style="padding-top: 10px;">
                <div class="form-group">
                    <label for="name-input">名称</label>
                    <input autocomplete="off" type="text" class="form-control" id="support-servant-input" value="">
                    <small class="form-text text-muted">
                        サポートサーヴァント名を入力してください
                        <br />
                        入力に応じて候補がサジェスト表示されます。
                    </small>
                </div>
            </div>

            <div class="col-lg-12">
                <div style="padding: 10px; " id="support-box">
                </div>

                <small class="form-text text-muted">
                    ※サポートサーヴァントの状態(スキルLv,使用可否)を編集する場合、
                    対象のサーヴァント名のラベルを押下します
                    <br /><br />
                </small>
            </div>
        </div>

        <br />

        <div class="row" style="border: 1px solid #f0f0f0;border-radius: 0.25rem;position: relative;">
            <div style="position: absolute;top: -10px;left: 10px;">
                <span class="badge badge-primary" style="cursor: pointer">その他</span>
            </div>

            <div class="col-lg-12" style="height: 15px;"></div>

            <div class="col-lg-2">
                <div class="form-group">
                    <label for="target-reisou-level">魔術礼装</label>
                    <select class="form-control" id="target-reisou-level">
                        <option value="1">lv1</option>
                        <option value="2">lv2</option>
                        <option value="3">lv2</option>
                        <option value="4">lv4</option>
                        <option value="5">lv5</option>
                        <option value="6">lv6</option>
                        <option value="7">lv7</option>
                        <option value="8">lv8</option>
                        <option value="9">lv9</option>
                        <option value="10">lv10</option>
                    </select>
                    <small class="form-text text-muted">
                        使用する魔術礼装のLvを選択します
                    </small>
                </div>
            </div>

            <div class="col-lg-10">
                <div class="form-group">
                    <label for="target-reisou-input">&nbsp;</label>
                    <select class="form-control" id="target-reisou-input">
                        <option atk="" a="" b="" q="" hogu="" value="0" help="無し">マスター礼装無し</option>
                        <option atk="30,32,34,36,38,40,42,44,46,50" a="" b="" q="" hogu="" value="1" help="攻30-50アップ">
                            魔術礼装・カルデア</option>
                        <option atk="20,21,22,23,24,25,26,27,28,30" a="" b="" q="" hogu="" value="2" help="攻20-30アップ">
                            カルデア戦闘服</option>
                        <option atk="" a="" b="40,42,44,46,48,50,52,54,56,60" q="" hogu="" value="3" help="B40-60アップ">
                            アニバーサリー・ブロンド(単体B)</option>
                        <option atk="" a="" b="" q="30,32,34,36,38,40,42,44,46,50" hogu="" value="4" help="Q30-50アップ">
                            ロイヤルブランド(単体Q)</option>
                        <option atk="" a="" b="" q="20,21,22,23,24,25,26,27,28,30" hogu="" value="5" help="Q20-30アップ">
                            ブリリアントサマー(全体Q)</option>
                        <option atk="" a="30,32,34,36,38,40,42,44,46,50" b="" q="" hogu="" value="6" help="A30-50アップ">
                            月の海の記憶(単体A)</option>
                        <option atk="" a="20,21,22,23,24,25,26,27,28,30" b="" q="" hogu="" value="7" help="A20-30アップ">
                            月の裏側の記憶(全体A)</option>
                        <option atk="" a="" b="" q="" hogu="30,32,34,36,38,40,42,44,46,50" value="8" help="宝具30-50アップ">
                            2004年の断片(単体宝具)</option>
                        <option atk="" a="20,22,24,26,28,30,32,34,36,40" b="" q="" hogu="10,11,12,13,14,15,16,17,18,20"
                            value="9" help="攻20-40アップ,宝具10-20アップ">極地用カルデア制服(単体ATK+宝具威力)</option>
                        <option atk="20,21,22,23,24,25,26,27,28,30" a="" b="" q="" hogu="10,11,12,13,14,15,16,17,18,20"
                            value="10" help="A20-30アップ,宝具10-20アップ">トロピカルサマー(単体A+宝具威力)</option>
                        <option atk="" a="" b="" q="" hogu="25,26,27,28,29,30,31,32,33,35" value="11" help="宝具25-35アップ">
                            晴れの新年(全体宝具威力)</option>
                    </select>
                    <small class="form-text text-muted">使用する魔術礼装を選択します</small>
                    <div id="reisou-help">
                    </div>
                </div>
            </div>

            <div class="col-lg-12" style="margin-bottom: 10px;">
                <button type="button" class="btn btn-primary btn-sm toggle-btn"
                    data-target="#target-other-buf">詳細</button>
                <small class="form-text text-muted">
                    手動でその他のバフを編集します
                </small>

            </div>

            <div class="col-lg-12" id="target-other-buf" style="display: none">
                <div class="row" style="padding: 15px;">
                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-atk-input">ATK(追加)</label>
                            <input id="other-atk-input" type="number" class="form-control" value="0">
                            <small class="form-text text-muted">
                                追加するATKを入力してください。(礼装など)
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-np-buf-input">NP獲得量バフ</label>
                            <input id="other-np-buf-input" type="number" class="form-control" value="0">
                            <small class="form-text text-muted">
                                NP獲得量アップの値を入力してください
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-np-get-input">ターン後NP獲得</label>
                            <input id="other-np-get-input" type="number" class="form-control" value="0">
                            <small class="form-text text-muted">
                                ターン終了時に取得できるNPの値を入力してください
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-card-buf-input">攻バフ・防デバフ</label>
                            <input id="other-atk-buf-input" type="number" class="form-control" value="0">
                            <small class="form-text text-muted">
                                追加する攻撃バフと防御デバフの総計を入力してください
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-card-buf-input">Cardバフ</label>
                            <input id="other-card-buf-input" type="number" class="form-control" value="0">
                            <small class="form-text text-muted">
                                追加するカードバフの総計を入力してください
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-2">
                        <div class="form-group">
                            <label for="other-hogu-buf-input">宝具バフ</label>
                            <input id="other-hogu-buf-input" type="text" class="form-control" value="0">
                            <small class="form-text text-muted">
                                追加する宝具バフの総計を入力してください
                            </small>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <small class="form-text text-muted">
                            ※その他、特攻バフなどは宝具バフと合算になります
                        </small>
                    </div>
                </div>
            </div>
        </div>

        </br>

        <div class="row" style="border: 1px solid #f0f0f0;border-radius: 0.25rem;position: relative;">
            <div style="position: absolute;top: -10px;left: 10px;">
                <span class="badge badge-primary" style="cursor: pointer">計算結果</span>
            </div>

            <div class="col-lg-12" style="padding-top: 20px">
                <div style="padding: 5px;">
                    <span class="badge badge-dark">獲得NP</span>
                </div>
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th scope="col">OverKill</th>
                            <th scope="col">剣/弓/槍(1.0)</th>
                            <th scope="col">術(1.2)</th>
                            <th scope="col">騎(1.1)</th>
                            <th scope="col">殺(0.9)</th>
                            <th scope="col">狂(0.8)</th>
                        </tr>
                    </thead>
                    <tbody id="result-np-data">
                    </tbody>
                </table>
            </div>

            <div class="col-lg-12" style="padding-top: 20px">
                <div style="padding: 5px;">
                    <span class="badge badge-dark">宝具ダメージ</span>
                </div>
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th scope="col">敵属性</th>
                            <th scope="col">最大</th>
                            <th scope="col">中間</th>
                            <th scope="col">最低</th>
                        </tr>
                    </thead>
                    <tbody id="result-damage-data">
                    </tbody>
                </table>
            </div>

            <div class="col-lg-12" id="result-buf-data" style="padding: 10px">
            </div>
        </div>

        <br /><br />

        <div class="modal fade" id="support-detail-modal" tabindex="-1" role="dialog"
            aria-labelledby="support-modal-title" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="support-modal-title"></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <div class="row">
                            <div class="col-lg-4">
                                <label for="support-skill1-lv-input">スキル1Lv</label>
                                <select class="form-control" id="support-skill1-lv-input" change-target="skill1">
                                    <option value="">使用しない</option>
                                    <option value="v1">lv1</option>
                                    <option value="v2">lv2</option>
                                    <option value="v3">lv3</option>
                                    <option value="v4">lv4</option>
                                    <option value="v5">lv5</option>
                                    <option value="v6">lv6</option>
                                    <option value="v7">lv7</option>
                                    <option value="v8">lv8</option>
                                    <option value="v9">lv9</option>
                                    <option value="v10">lv10</option>
                                </select>
                                <small class="form-text text-muted" id="support-skill1-lv-name"></small>
                            </div>
                            <div class="col-lg-4">
                                <label for="support-skill2-lv-input">スキル2Lv</label>
                                <select class="form-control" id="support-skill2-lv-input" change-target="skill2">
                                    <option value="">使用しない</option>
                                    <option value="v1">lv1</option>
                                    <option value="v2">lv2</option>
                                    <option value="v3">lv3</option>
                                    <option value="v4">lv4</option>
                                    <option value="v5">lv5</option>
                                    <option value="v6">lv6</option>
                                    <option value="v7">lv7</option>
                                    <option value="v8">lv8</option>
                                    <option value="v9">lv9</option>
                                    <option value="v10">lv10</option>
                                </select>
                                <small class="form-text text-muted" id="support-skill2-lv-name"></small>
                            </div>
                            <div class="col-lg-4">
                                <label for="support-skill3-lv-input">スキル3Lv</label>
                                <select class="form-control" id="support-skill3-lv-input" change-target="skill3">
                                    <option value="">使用しない</option>
                                    <option value="v1">lv1</option>
                                    <option value="v2">lv2</option>
                                    <option value="v3">lv3</option>
                                    <option value="v4">lv4</option>
                                    <option value="v5">lv5</option>
                                    <option value="v6">lv6</option>
                                    <option value="v7">lv7</option>
                                    <option value="v8">lv8</option>
                                    <option value="v9">lv9</option>
                                    <option value="v10">lv10</option>
                                </select>
                                <small class="form-text text-muted" id="support-skill3-lv-name"></small>
                            </div>

                            <div class="col-lg-12" id="support-buf-data">
                            </div>

                            <div class="col-lg-12" style="margin-top: 10px;">
                                <button id="support-delete-btn" type="button" class="btn btn-danger btn-sm">削除</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="text/x-handlebars" id="template-np-result">
        {{#each this}}
        <tr>
            <td>{{label}}</td>
            <td>{{d1}} ({{a1}})</td>
            <td>{{d2}} ({{a2}})</td>
            <td>{{d3}} ({{a3}})</td>
            <td>{{d4}} ({{a4}})</td>
            <td>{{d5}} ({{a5}})</td>
        </tr>
        {{/each}}
    </script>

    <script type="text/x-handlebars" id="template-damage-result">
        {{#each this}}
        <tr>
            <td>{{label}}</td>
            <td>{{d1}}</td>
            <td>{{d2}}</td>
            <td>{{d3}}</td>
        </tr>
        {{/each}}
    </script>

    <div>
        <script src="resources/jquery/jquery-3.4.1.min.js"></script>
        <script src="resources/jquery-ui-1.12.1/jquery-ui.min.js"></script>
        <script src="resources/bootstrap/js/bootstrap.js"></script>
        <script src="resources/handlebars/handlebars-v4.2.0.js"></script>
        <script src="resources/fgoutil/fgocalc.js"></script>
        <script src="servant.js"></script>

        <script>
            var applications = (function() {
                var appmap = {};

                function rerender(pageid, query) {
                    var a = appmap[pageid];
                    if(a !== undefined) {
                        var html = a.rerender(query);
                        $("#container").html(html).attr("page", pageid);
                    }
                };

                function install(install, callback) {
                    appmap[install] = callback();
                };

                return function(a1, a2) {
                  
                    if(arguments.length === 0) {
                        Object.keys(appmap).map(function(k) {
                            return appmap[k];
                        }).forEach(function(app) {
                            app.load();
                        });
                    } else if(typeof a1 === "string" && typeof a2 === "string") {
                        rerender(a1, a2);
                    } else if(typeof a1 === "string" && typeof a2 === "function") {
                        install(a1, a2);
                    }
                };
            })();

            $(function() {
                applications();

                function repage(hash) {
                    hash = hash === "" ? "#list" : hash.substring(1);
                    var queryPoint = hash.indexOf("?");
                    var query = queryPoint !== -1 ? hash.substring(queryPoint+1) : "";
                    var appId = queryPoint !== -1 ? hash.substring(0, queryPoint) : hash;

                    applications(appId, query);
                };

                $(window).on('hashchange',function(){
                    var hash = location.hash;
                    repage(hash);                    
                });

                (function() {
                    var hash = location.hash;
                    repage(hash);          
                })();
            });
        </script>

        <script src="app/list.js"></script>
    </div>
</body>

</html>