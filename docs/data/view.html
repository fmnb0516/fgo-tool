<!doctype html>
<html lang="ja">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="application-name" content="FGO鯖データ">
    <link rel="stylesheet" href="../resources/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../resources/jquery-ui-1.12.1/jquery-ui.min.css">
    <title>FGO データ編集</title>
    <link rel="apple-touch-icon" href="../apple-touch-icon.png">
    <link rel="icon" href="../favicon.ico">
</head>

<body>

  <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
    <div class="container">
      <a href="./index.html" class="navbar-brand">FGO データ参照</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="./list.html">サーヴァント一覧</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./calcnp.html">FGO 獲得NP計算機</a>
          </li>
        </ul>

      </div>
    </div>
  </div>

  <div class="container" style="padding-top: 70px;" id="container">

  </div>

  <script type="text/x-handlebars" id="template-hogu-effect-input">
    <tr>
      <td>
        <input readonly type="text" class="hogu-type-input" value="{{type}}" style="width: 150px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-tern-input" value="{{tern}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-count-input" value="{{count}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-target-input" value="{{effectTarget target}}" style="width: 150px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-beforeafter-input" value="{{beforeafterLabel beforeafter}}" style="width: 50px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-lvoc-input" value="{{lvocLabel lvoc}}" style="width: 50px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-desc-input" value="{{desc}}" style="width: 300px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-val1-input" value="{{v1}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-val2-input" value="{{v2}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-val3-input" value="{{v3}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-val4-input" value="{{v4}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="hogu-val5-input" value="{{v5}}" style="width: 30px;">
      </td>
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-skill-effect-input">
    <tr>
      <td>
        <input readonly type="text" class="skill-type-input" value="{{type}}" style="width: 150px;">
      </td>
      <td>
        <input readonly type="text" class="skill-tern-input" value="{{tern}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-count-input" value="{{count}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-target-input" value="{{effectTarget target}}" style="width: 150px;">
      </td>
      <td>
        <input readonly type="text" class="skill-desc-input" value="{{desc}}" style="width: 300px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val1-input" value="{{v1}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val2-input" value="{{v2}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val3-input" value="{{v3}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val4-input" value="{{v4}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val5-input" value="{{v5}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val6-input" value="{{v6}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val7-input" value="{{v7}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val8-input" value="{{v8}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val9-input" value="{{v9}}" style="width: 30px;">
      </td>
      <td>
        <input readonly type="text" class="skill-val10-input" value="{{v10}}" style="width: 30px;">
      </td>     
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-classskill-effect-input">
    <tr>
      <td>
        <input readonly type="text" class="skill-type-input" value="{{type}}" style="width: 150px;">
      </td>
      <td>
        <input readonly type="text" class="magnification-input" value="{{magnification}}" style="width: 50px;">
      </td>
      <td>
        <input readonly type="text" class="desc-input" value="{{desc}}" style="width: 300px;">
      </td>
      <td>
          
      </td>
    </tr>
  </script>

  <script type="text/x-handlebars" id="template-classskill-input">
    <div class="col-lg-12 classskill-entry" style="margin-bottom: 25px;">
      <div class="card border-primary delete-entry">
        <div class="card-header">
          <input readonly type="text" class="form-control classkill-name-input" value={{name}}>
        </div>
        
        <div class="card-body table-responsive">
          <table class="table table-hover text-nowrap">
            <thead>
              <tr>
                <th>種別</th>
                <th>倍率</th>
                <th>説明文</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              {{#each effect}}
                {{include "template-classskill-effect-input" this}}
              {{/each}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars" id="template-tag-input">
    <input readonly class="tag-input" style="width: 100px;margin-left: 5px;margin-bottom: 5px;" type="text" value="{{this}}">
  </script>

  <script type="text/x-handlebars" id="template-status-input">
    <div class="row alert alert-dismissible alert-secondary delete-entry" style="padding: 10px;">
        <div class="col-lg-2">
          <div class="form-group">
            <label>Level</label>
            <input readonly type="text" class="form-control status-lv-input" value="{{level}}">
          </div>
        </div>
        <div class="col-lg-5">
          <div class="form-group">
            <label>HP</label>
            <input readonly type="text" class="form-control status-hp-input" value="{{hp}}">
          </div>
        </div>
        <div class="col-lg-5">
          <div class="form-group">
            <label>ATK</label>
            <input readonly type="text" class="form-control status-atk-input" value="{{atk}}">
          </div>
        </div>
      </div>
  </script>

  <script type="text/x-handlebars" id="template-editable-form">
    <hr/>

    <div class="row">
      <div class="col-lg-4">
        <div class="form-group">
          <label for="name-input">名称</label>
          <input readonly type="text" class="form-control" id="name-input" value="{{data.servant.name}}">
        </div>
      </div>

      <div class="col-lg-2">
          <div class="form-group">
            <label for="no-input">No</label>
            <input readonly type="text" class="form-control" id="no-input" value="{{data.servant.no}}">
          </div>
        </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="class-input">クラス</label>
          <input readonly type="text" class="form-control" id="class-input" value="{{servantClass data.servant.clazz}}">
        </div>
      </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="rare-input">レア度</label>
          <input readonly type="text" class="form-control" id="rare-input" value="{{data.servant.rare}}">
        </div>
      </div>
      <div class="col-lg-2">
        <div class="form-group">
          <label for="cost-input">コスト</label>
          <input readonly type="text" class="form-control" id="cost-input" value="{{data.servant.cost}}">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        コマンドカード
        <div class="row" style="padding: 10px;">
          <div class="col-lg-12"><span class="badge badge-primary">Arts</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-arts-count-input">枚数</label>
              <input readonly type="text" class="form-control" id="command-arts-count-input" value="{{data.card.arts.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-arts-hit-input">ヒット数</label>
              <input readonly type="text" class="form-control" id="command-arts-hit-input" value="{{data.card.arts.hit}}">
            </div>
          </div>

          <div class="col-lg-12"><span class="badge badge-success">Quick</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-quick-count-input">枚数</label>
              <input readonly type="text" class="form-control" id="command-quick-count-input" value="{{data.card.quick.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-quick-hit-input">ヒット数</label>
              <input readonly type="text" class="form-control" id="command-quick-hit-input" value="{{data.card.quick.hit}}">
            </div>
          </div>

          <div class="col-lg-12"><span class="badge badge-danger">Buster</span></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-buster-count-input">枚数</label>
              <input readonly type="text" class="form-control" id="command-buster-count-input" value="{{data.card.buster.count}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="command-buster-hit-input">ヒット数</label>
              <input readonly type="text" class="form-control" id="command-buster-hit-input" value="{{data.card.buster.hit}}">
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-lg-12">
        ステータス &nbsp;&nbsp;

        <br /><br />
        <div id="status-container">
        {{#each data.status}}
          {{include "template-status-input" this}}
        {{/each}}
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        隠しステータス
        <div class="row" style="padding: 10px;">
          <div class="col-lg-2">
            <div class="form-group">
              <label for="tenchizin-input">相性</label>
              <input readonly id="tenchizin-input" type="text" class="form-control" value="{{data.servant.tenchizin}}">
            </div>
          </div>


          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-na">N/A</label>
              <input readonly id="input-na" type="text" class="form-control" value="{{data.hidden.na}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-star-occurrence">スター発生率</label>
              <input readonly id="input-star-occurrence" type="text" class="form-control" value="{{data.hidden.staroccurrence}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-star-collection">スター集中度</label>
              <input readonly id="input-star-collection" type="text" class="form-control" value="{{data.hidden.starcollection}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-dr">DR</label>
              <input readonly id="input-dr" type="text" class="form-control" value="{{data.hidden.dr}}">
            </div>
          </div>

          <div class="col-lg-2">
            <div class="form-group">
              <label for="input-nd">ND</label>
              <input readonly id="input-nd" type="text" class="form-control" value="{{data.hidden.nd}}">
            </div>
          </div>

          <div class="col-lg-12">
            <label for="input-tag">属性</label>
            &nbsp;&nbsp;

            <div style="padding: 5px" id="tag-container">
              {{#each data.hidden.tag}}
                {{include "template-tag-input" this}}
              {{/each}}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        クラススキル &nbsp;&nbsp;

        <div class="row" id="class-skill-container" style="padding: 10px;">
          {{#each data.classskill}}
            {{include "template-classskill-input" this}}
          {{/each}}
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル1
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-1-name-input">名称</label>
              <input readonly type="text" class="form-control" id="skill-1-name-input" value="{{data.skill1.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input readonly type="text" class="form-control" id="skill-1-ct-input" value="{{data.skill1.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>ターン</th>
                  <th>回数</th>
                  <th>対象</th>
                  <th>説明文</th>
                  <th>Lv1</th>
                  <th>Lv2</th>
                  <th>Lv3</th>
                  <th>Lv4</th>
                  <th>Lv5</th>
                  <th>Lv6</th>
                  <th>Lv7</th>
                  <th>Lv8</th>
                  <th>Lv9</th>
                  <th>Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill1.effects}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル2
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-2-name-input">名称</label>
              <input readonly type="text" class="form-control" id="skill-2-name-input" value="{{data.skill2.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input readonly type="text" class="form-control" id="skill-2-ct-input" value="{{data.skill2.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>ターン</th>
                  <th>回数</th>
                  <th>対象</th>
                  <th>説明文</th>
                  <th>Lv1</th>
                  <th>Lv2</th>
                  <th>Lv3</th>
                  <th>Lv4</th>
                  <th>Lv5</th>
                  <th>Lv6</th>
                  <th>Lv7</th>
                  <th>Lv8</th>
                  <th>Lv9</th>
                  <th>Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill2.effects}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        スキル3
        <div class="row" style="padding: 10px;">
          <div class="col-lg-9">
            <div class="form-group">
              <label for="skill-2-name-input">名称</label>
              <input readonly type="text" class="form-control" id="skill-3-name-input" value="{{data.skill3.name}}">
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-group">
              <label for="skill-1-ct-input">CT</label>
              <input readonly type="text" class="form-control" id="skill-3-ct-input" value="{{data.skill3.ct}}">
            </div>
          </div>
          <div class="col-lg-12 skill-effect-entry table-responsive">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>ターン</th>
                  <th>回数</th>
                  <th>対象</th>
                  <th>説明文</th>
                  <th>Lv1</th>
                  <th>Lv2</th>
                  <th>Lv3</th>
                  <th>Lv4</th>
                  <th>Lv5</th>
                  <th>Lv6</th>
                  <th>Lv7</th>
                  <th>Lv8</th>
                  <th>Lv9</th>
                  <th>Lv10</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.skill3.effects}}
                  {{include "template-skill-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        宝具
        <div class="row" style="padding: 10px;">
          <div class="col-lg-6">
            <div class="form-group">
              <label for="hogu-name-input">名称</label>
              <input readonly type="text" class="form-control" id="hogu-name-input" value="{{data.hogu.name}}">
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-type-input">種別</label>
              <input readonly type="text" class="form-control" id="hogu-type-input" value="{{hogutype data.hogu.type}}">
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-card-input">カード</label>
              <input readonly type="text" class="form-control" id="hogu-card-input" value="{{card data.hogu.card}}">
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-group">
              <label for="hogu-hit-input">Hit数</label>
              <input readonly type="text" class="form-control" id="hogu-hit-input" value="{{data.hogu.hit}}">
            </div>
          </div>
          <div class="col-lg-12 table-responsive hogu-effect-entry">
            <table class="table text-nowrap">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>ターン</th>
                  <th>回数</th>
                  <th>対象</th>
                  <th>前・後</th>
                  <th>OC・Lv</th>
                  <th>説明文</th>
                  <th>1</th>
                  <th>2</th>
                  <th>3</th>
                  <th>4</th>
                  <th>5</th>
                </tr>
              </thead>
              <tbody>
                {{#each data.hogu.effect}}
                  {{include "template-hogu-effect-input" this}}
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </script>

  <div>
      <script>
          if ('serviceWorker' in navigator) {
              navigator.serviceWorker.register('../sw.js').then(function(registration) {
                  console.log('ServiceWorker の登録に成功しました。スコープ: ', registration.scope);
              }).catch(function(err) {
                  console.log('ServiceWorker の登録に失敗しました。', err);
              });
          }
      </script>

    <script src="../resources/jquery/jquery-3.4.1.min.js"></script>
    <script src="../resources/bootstrap/js/bootstrap.js"></script>
    <script src="../resources/handlebars/handlebars-v4.2.0.js"></script>
    <script src="../resources/fgoutil/fgocalc.js"></script>

    <script type="text/javascript">

      $(function () {
        var template = Handlebars.compile($("#template-editable-form").html());
        var constData = fgo.constData();

        var hash = location.hash;
        var dataId = null;

        Handlebars.registerHelper('servantClass', function (id) {
          return fgo.classToLabel(id);
        });

        Handlebars.registerHelper('card', function (id) {
          var map = {
            "a": "Arts",
            "q": "Quick",
            "b": "Buster"
          };
          return map[id];
        });

        Handlebars.registerHelper('hogutype', function (v) {
          var map = {
            "all": "全体",
            "single": "単体",
            "support": "補助"
          };
          return map[v];
        });

        Handlebars.registerHelper('beforeafterLabel', function (v) {
          return v === "before" ? "前" : "後";
        });

        Handlebars.registerHelper('lvocLabel', function (v) {
          return v === "lv" ? "Level" : "OC";
        });

        Handlebars.registerHelper('effectTarget', function (id) {
          var map = {
            "self": "自身",
            "other-all": "自身を除く全体",
            "self-other": "全体",
            "other-single": "味方単体",
            "enemy-single": "敵単体",
            "enemy-all": "敵全体"
          };
          return map[id];
        });

        Handlebars.registerHelper('include', function (id, data) {
          const tpl = Handlebars.compile($("#" + id).html());
          return new Handlebars.SafeString(tpl(data));
        });

        Handlebars.registerHelper('selected', function (v1, v2) {
          return v1 === v2 ? "selected" : "";
        });

        Handlebars.registerHelper('fgo-buf-type-option', function (v1) {
          var html = constData.effects.map(function (t) {
            var selected = t === v1 ? "selected" : "";
            return "<option " + selected + " value=\"" + t + "\">" + t + "</option>";
          });

          return new Handlebars.SafeString(html);
        });

        if (hash === "" || hash === "#") {

          var html = template({
            constData: constData
          });
          $("#container").html(html);

        } else {

          dataId = decodeURI(hash.substring(1));

          $.ajax({
            url: "../json/" + dataId,
            type: "GET",
            dataType: "json",
          }).done(function (data, textStatus, xhr) {
            var html = template({
              constData: constData,
              data: data
            });
            $("#container").html(html);
          }).fail(function (xhr, textStatus, e) {
          });

        }
      });

    </script>
  </div>
</body>

</html>